/*!Magix 1.2 Licensed MIT*/!function(a,b,c,d,e,f,g,h,i,j){j=1,i=function(a){return a.id||(a.id="mx_n_"+j++)},h("magix/magix",function(c){var g=c("jquery"),h=/\/\.(?:\/|$)|\/[^\/]+?\/\.{2}(?:\/|$)|\/\/+|\.{2}\//,i=/\/[^\/]*$/,k=/[#?].*$/,l=/([^=&?\/#]+)=?([^&#?]*)/g,m=/\?|(?!^)=/,n=/^https?:\/\//i,o="/",p="vframe",q=b.console,r=q&&q.error,s={tagName:p,rootId:"magix_vf_root",coded:1,error:r?function(a){q.error(a)}:d},t=s.hasOwnProperty,u=function(a,b){return a&&t.call(a,b)},v=function(b){return function(c,d,e){switch(arguments.length){case 0:e=b;break;case 1:e=D._o(c)?y(b,c):u(b,c)?b[c]:a;break;case 2:d===a?(delete b[c],e=d):b[c]=e=d}return e}},w=function(a,b){return b.f-a.f||b.t-a.t},x=function(a,b){var c=this;return c instanceof x?(c.c=[],c.b=0|b||5,c.x=c.b+(a||20)):c=new x(a,b),c},y=function(a,b,c,d){for(d in b)c&&u(c,d)||(a[d]=b[d]);return a};y(x.prototype,{get:function(a){var b,c=this,d=c.c;return a=e+a,u(d,a)&&(b=d[a],b.f>=1&&(b.f++,b.t=j++,b=b.v)),b},list:function(){return this.c},set:function(a,b,c){var d=this,f=d.c,g=e+a,h=f[g];if(!u(f,g)){if(f.length>=d.x){f.sort(w);for(var i=d.b;i--;)h=f.pop(),h.f>0&&d.del(h.o)}h={o:a},f.push(h),f[g]=h}return h.v=b,h.f=1,h.t=j++,h.m=c,b},del:function(a){a=e+a;var b=this.c,c=b[a];c&&(c.f=-1,c.v=f,delete b[a],c.m&&(B(c.m,c.o,c),c.m=f))},has:function(a){return u(this.c,e+a)}});var z=x(40),A=x(),B=function(a,b,c,d,e,f){for(D._a(a)||(a=[a]),b&&(D._a(b)||b.callee)||(b=[b]),d=0;d<a.length;d++)try{f=a[d],e=f&&f.apply(c,b)}catch(g){s.error(g)}return e},C=function(a,b,c){if(s.coded)try{c=decodeURIComponent(c)}catch(d){}C.p[b]=c},D={mix:y,has:u,tryCall:B,config:v(s),start:function(a){var b=this;y(s,a),b.use(["magix/router","magix/vom",a.iniFile],function(c,d,e){s=y(s,e,a),s["!tnc"]=s.tagName!=p,c.on("!ul",d.loc),c.on("changed",d.loc),b.use(s.extensions||s.exts,c.start)})},keys:Object.keys||function(a){var b,c=[];for(b in a)u(a,b)&&c.push(b);return c},local:v({}),path:function(a,b){var c,d=a+e+b,g=A.get(d),j=f;if(!A.has(d)){for(n.test(a)&&(c=a.indexOf(o,8),0>c&&(c=a.length),j=a.slice(0,c),a=a.slice(c)),a=a.replace(k,f).replace(i,o),(n.test(b)||b.charAt(0)==o)&&(a=f),g=a+b;h.test(g);)g=g.replace(h,o);A.set(d,g=j+g)}return g},toObject:function(a){var b,c,d=z.get(a);return d||(C.p=b={},c=a.replace(k,f),m.test(c)&&(c=f),a.replace(c,f).replace(l,C),z.set(a,d=[c,b])),{path:d[0],params:y({},d[1])}},toUrl:function(a,b,c){var d,e,f,g=[];for(e in b)d=b[e],(!c||d||u(c,e))&&(s.coded&&(d=encodeURIComponent(d)),f=1,g.push(e+"="+d));return f&&(a=(a&&a+(m.test(a)?"&":"?"))+g.join("&")),a},toMap:function(a,b){var c,d,e,f={},g=arguments.length>1;if(a&&(e=a.length))for(c=0;e>c;c++)d=a[c],f[g?d[b]:d]=g?d:(0|f[d])+1;return f},cache:x},E=function(){};return y(D,{use:function(a,b){a?seajs.use(a,b):b&&b()},_a:g.isArray,_f:g.isFunction,_s:function(a){return"string"==g.type(a)},_o:function(a){return"object"==g.type(a)},extend:function(a,b,c,d){var e=b.prototype;e.constructor=b,E.prototype=e;var f=new E;return y(f,c),y(a,d),f.constructor=a,a.prototype=f,a}})}),h("magix/event",function(a){var b=a("./magix"),c=b.tryCall,d={fire:function(a,b,d,f){var g=e+a,h=this,i=h[g];if(i){b||(b={}),b.type||(b.type=a);for(var j,k,l=i.length,m=l-1;l--;)j=f?l:m-l,k=i[j],(k.d||k.r)&&(i.splice(j,1),m--),k.d||c(k.f,b,h);d=d||0>m}d&&delete h[g]},on:function(a,b,d,f){var g=this,h=e+a,i=g[h]||(g[h]=[]),j={f:b},k=0|d;k!==d?(d&&d.on&&f&&(d.on(f,function(){j.d=1},c),d=0),j.r=d,i.push(j)):i.splice(k,0,j)},off:function(a,b){var c=e+a,d=this[c];if(d)if(b){for(var f,g=d.length-1;g>=0;g--)if(f=d[g],f.f==b&&!f.d){f.d=1;break}}else delete this[c]},once:function(a,b){this.on(a,b,c)}};return b.mix(b.local,d),d}),h("magix/router",function(a){var c,d,f,h,i,j,k=a("./magix"),l=a("./event"),m=a("jquery"),n="",o="path",p="view",q=k.has,r=k.mix,s=k.keys,t=k.toUrl,u=k.toObject,v=k.config(),w=k.cache(),x=k.cache(),y=b.location,z=b.history,A={params:{},href:n},B=/(?:^https?:\/\/[^\/]+|#.*$)/gi,C=/^[^#]*#?!?/,D="params",E=function(a,b,c){if(a){c=this[D],a=(a+n).split(g);for(var d=0;d<a.length&&!(b=q(c,a[d]));d++);}return b},F=function(){return this[o]},G=function(){return this[p]},H=function(a,b,c,d){return c=this,d=c[D],arguments.length>1?d[a]=b:d[a]||n},I=function(a,b){var c,e,f,g;return d||(d={rs:v.routes||{},nf:v.unfoundView},f=v.defaultView,d.dv=f,g=v.defaultPath,c=d.rs,d.f=k._f(c),d.f||c[g]||!f||(c[g]=f),d[o]=g),a||(a=d[o]),c=d.rs,e=d.f?c.call(v,a,b):c[a],{view:e||d.nf||d.dv,path:a}},J=function(a,b){var c=a.href,d=b.href,f=c+e+d,g=x.get(f);if(!g){var h,i,j,k;g={isParam:E,isPath:F,isView:G,location:b,force:!a.get},g[p]=j,g[o]=j,g[D]=k={};var l,m,n=a[D],q=b[D],r=[o,p].concat(s(n),s(q));for(l=r.length-1;l>=0;l--)m=r[l],1==l&&(n=a,q=b,k=g),i=n[m],j=q[m],i!=j&&(k[m]={from:i,to:j},h=1);x.set(f,g=[h,g])}return g},K=r({start:function(){f=v.edge,h=f&&z.pushState,i=f&&!h,j=h?"srcQuery":"srcHash",K.bind(h),K.route()},parse:function(a,b){a=a||y.href;var c,d,e,g,h,j,l=w.get(a);return l||(e=a.replace(B,n),g=a.replace(C,n),h=u(e),j=u(g),i&&(j[o]=k.path(y.pathname,j[o])),l={get:H,set:H,href:a,refHref:A.href,srcQuery:e,srcHash:g,query:h,hash:j,params:r(r({},h[D]),j[D])},w.set(a,l)),b&&!l[p]&&(d=l.hash[o]||f&&l.query[o],c=I(d,l),r(l,c)),l},route:function(){var a=K.parse(0,1),b=J(A,a);A=a,b[0]&&(c=a,K.fire("changed",b[1]))},navigate:function(a,b,d){if(c){!b&&k._o(a)&&(b=a,a=n);var e=u(a),g=c.query[D],l=e[D],m=e[o],p=c[o];if(r(l,b),m){if(m=k.path(p,m),i)for(var s in g)q(g,s)&&!q(l,s)&&(l[s]=n)}else m=p,l=r(r({},c[D]),l);m=t(e[o]=m,l,f?o:g),m!=c[j]&&(h?(z[d?"replaceState":"pushState"](n,n,m),K.route()):(r(e,c,e),e.srcHash=m,K.fire("!ul",{loc:c=e}),m="#!"+m,d?y.replace(m):y.hash=m),K.did=1)}}},l);return K.bind=function(a){var b=location.href;a?m(window).on("popstate",function(){var a=location.href==b;(K.did||!a)&&(K.did=1,K.route())}):m(window).on("hashchange",K.route)},K}),h("magix/vom",function(a){var b=a("./vframe"),c=a("./magix"),d=a("./event"),e=c.has,f=c.mix,g={},h={},i={},j=c.mix({all:function(){return g},add:function(a,b){e(g,a)||(g[a]=b,j.fire("add",{vframe:b}))},get:function(a){return g[a]},remove:function(a,b){var c=g[a];c&&(delete g[a],j.fire("remove",{vframe:c,fcc:b}))},loc:function(a){var c,d=a.loc;if(d?c=1:d=a.location,f(h,d),!c){f(i,a);var e=b.root(j,h,i);i.view?e.mountView(d.view):b.update(e)}}},d);return j}),h("magix/vframe",function(b){var d,e,f,g,h,j,k,l,m,n,o,p=b("./magix"),q=b("./event"),r=b("./view"),s=p.tryCall,t=[],u=p.mix,v=p.config(),w="mx-vframe",x=p.has,y="querySelectorAll",z="alter",A="created",B="object",C=function(a){return typeof a==B?a:c.getElementById(a)},D=function(a,b,e){return b=C(a),b&&(e=f?c[y]("#"+i(b)+h):b.getElementsByTagName(d)),e||t},E=function(a,b,c){if(a=C(a),b=C(b),a&&b)if(a!==b)try{c=j?b.contains(a):16&b.compareDocumentPosition(a)}catch(d){c=0}else c=1;return c},F=function(a){if(a.cC==a.rC){var b=a.view;b&&!a.fcc&&(a.fcc=1,a.fca=0,b.fire(A),a.fire(A));var c=a.id,d=o.get(a.pId);d&&!x(d.rM,c)&&(d.rM[c]=d.cM[c],d.rC++,F(d))}},G=function(a,b){if(b||(b={}),!a.fca&&a.fcc){a.fcc=0;var c=a.view,d=a.id;c&&(a.fca=1,c.fire(z,b),a.fire(z,b));var e=o.get(a.pId);e&&x(e.rM,d)&&(e.rC--,delete e.rM[d],a._p||G(e,b))}},H=function(a,b){var c=this;c.id=a,c.cM={},c.cC=0,c.rC=0,c.sign=1,c.rM={},c.pId=b,o.add(a,c)};return H.root=function(b,i,l){if(!k){d=v.tagName,e=v["!tnc"],f=e&&c[y],h=" "+d+"["+w+"=true]",g=e&&!f;var p=c.body;j=p.contains,m=i,n=l,o=b;var q=v.rootId,r=C(q);r||(r=c.createElement(d),r.id=q,p.appendChild(r),r=a),k=new H(q)}return k},H.update=function(a){var b=a.view;if(a.viewInited&&b&&b.sign>0){var c=b.olChg(n);c&&b.render(n);for(var d,e=a.children(),f=0,g=e.length;g>f;f++)d=o.get(e[f]),d&&H.update(d)}},u(u(H.prototype,q),{mountView:function(a,b,c){var d=this,e=C(d.id);if(!d._a&&e&&(d._a=1,d._t=e.innerHTML),d.unmountView(c),d._d=0,a){d.path=a;var f=p.toObject(a),g=f.path,h=++d.sign;p.use(g,function(a){if(h==d.sign){r.prepare(a,o);var c=new a({owner:d,id:d.id,$:C,$i:E,path:g,vom:o,location:m});d.view=c;var i=function(a){d.mountZoneVframes(a.id)};c.on("interact",function(){c.hasTmpl||(e&&(e.innerHTML=d._t),i(C)),c.on("rendered",i),c.on("prerender",function(a){d.unmountZoneVframes(a.id,0,1)||G(d)})},0),c.load(u(f.params,b),n)}})}},unmountView:function(a){var b=this,c=b.view;if(c){l||(l={}),b._d=1,b.unmountZoneVframes(0,a,1),G(b,l),b.view=0,c.oust();var d=C(b.id);d&&b._a&&!a&&(d.innerHTML=b._t),b.viewInited=0,l=0}b.sign++},mountVframe:function(a,b,c,d,e){var f=this;f.fcc&&!d&&G(f);var g=o.get(a);return g||(x(f.cM,a)||f.cC++,f.cM[a]=1,g=new H(a,f.id)),g._p=d,g.mountView(b,c,e),g},mountZoneVframes:function(a,b,c,d){var e=this;a=a||e.id,e.unmountZoneVframes(a,d,1);var f=D(a),h=f.length,j={};if(h)for(var k,l,m,n,o=0;h>o;o++)if(k=f[o],l=i(k),!x(j,l)&&(m=k.getAttribute("mx-view"),n=g?k.getAttribute(w):1,n||m)){e.mountVframe(l,m,b,c,d);for(var p,q=D(k),r=0,s=q.length;s>r;r++)p=q[r],j[i(p)]=1}F(e)},unmountVframe:function(a,b,c){var d=this;a=a||d.id;var e=o.get(a);if(e){var f=e.fcc;e.unmountView(b),o.remove(a,f);var g=o.get(e.pId);g&&x(g.cM,a)&&(delete g.cM[a],g.cC--,c||F(g))}},unmountZoneVframes:function(a,b,c){var d,e,f=this,g=f.cM;for(e in g)(!a||E(e,a))&&f.unmountVframe(e,b,d=1);return c||f._d||F(f),d},parent:function(a){var b=this,c=b;for(a=a>>>0||1;c&&a--;)c=o.get(c.pId);return c},children:function(){return p.keys(this.cM)},invokeView:function(a,b){var c,d=this;if(d.viewInited){var e=d.view,f=e&&e[a];f&&(c=s(f,b||t,e))}return c}}),H}),h("magix/view",function(h){var j,k=h("./magix"),l=h("./event"),m=h("./router"),n=h("jquery"),o={focus:2,blur:2,mouseenter:2,mouseleave:2},p=n.now(),q=function(a,b,c,d,e,g){var h=o[b];if(e){c.$n||(c.$n=p--);var i="_$"+c.$n;e[i]||(e[i]=function(){c.apply(e,arguments)}),c=e[i]}g||2!=h?n(a)[d?"off":E](b,c):n(a)[(d?"un":f)+"delegate"]("[mx-"+b+"]",b,c)},r=k.tryCall,s=k.has,t=[],u=k.mix,v=0,w="destroy",x=k.cache(40),y=/(\w+)(?:<(\w+)>)?(?:\(({[\s\S]*})\))?/,z=/([$\w]+)<([\w,]+)>/,A={},B=c.body,C="parentNode",D=/\smx-(?!view|vframe)[a-z]+\s*=\s*"/g,E="on",F="",G=function(a,b){return function(){b=this,b.sign>0&&(b.sign++,b.fire("rendercall"),H(b),r(a,arguments,b))}},H=function(a,b){var c,d,e=a.$res;for(c in e)d=e[c],(b||d.x)&&I(e,c,1)},I=function(a,b,c){var d,e,f=a[b];f&&(d=f.e,e=d&&d[w],e&&r(e,t,d),(!f.k||c)&&delete a[b])},J=function(a,b){var c,d,e=a.$evts;for(c in e)L(c,b);for(e=a.$sevts,c=e.length;c-->0;)d=e[c],q(d.h,d.t,d.f,b,a,1)},K=function(b){if(b&&!b[E]){var c=b.target;b[E]=1;for(var d,f,g,h=c,k=b.type,l="mx-"+k,m=[];h&&1==h.nodeType&&(f=h.ei,!(f&&f[k]||(d=h.getAttribute(l))));)m.push(h),h=h[C];if(d){for(var n,o,p,q,t,u,v,w,z,A=d.split(F);A.length;)if(o=A.shift()){if(p=o.split(e),o=p.pop(),u=p[0],!u&&!n)for(v=h,w=j.all();v;){if(s(w,z=v.id)){h.setAttribute(l,(u=z)+e+d);break}v=v[C]}if(n=1,!u)throw Error("bad:"+o);if(q=j.get(u),t=q&&q.view,t&&t.sign>0){b.currentId=i(h),b.targetId=i(c),b.prevent=b.preventDefault,b.stop=b.stopPropagation;var B=x.get(o);B||(B=o.match(y),B={n:B[1],f:B[2],i:B[3]},B.p=B.i&&r(Function("return "+B.i))||{},x.set(o,B));var D=B.n+e+k,G=t[D];G&&(b[B.f]&&b[B.f](),b.params=B.p,r(G,b,t))}}}else{for(;m.length;)g=m.pop(),f=g.ei||(g.ei={}),f[k]=1;g=a}h=c=a}},L=function(a,b){var c=0|A[a],d=c>0?1:0;c+=b?-d:d,c||(q(B,a,K,b),b||(c=1)),A[a]=c},M=function(a){var b=this;u(b,a),b.$ol={ks:[]},b.$res={},b.sign=1,r(M.$,a,b)},N=M.prototype,O={$win:b,$doc:c};M.$=[],M.prepare=function(a,b){if(!a[e]){a[e]=1,j=b;var c,d,f,h,i,k,l=a.prototype,m={},n=[];for(var o in l)if(c=l[o],d=o.match(z))for(f=d[1],h=d[2],h=h.split(g),i=h.length-1;i>-1;i--)d=h[i],k=O[f],k?n.push({n:f,t:d,h:k,f:c}):l[k=f+e+d]||(m[d]=1,l[k]=c);else"render"==o&&(l[o]=G(c));l.$evts=m,l.$sevts=n}},M.mixin=function(a,b){b&&M.$.push(b),u(N,a)},u(u(N,l),{render:d,navigate:m.navigate,init:d,hasTmpl:!0,wrapEvent:function(a,b){a+=f;var c=this.id+e;return a=b?[f].concat(a).join(F+c):a.replace(D,"$&"+c)},load:function(){var a=this,b=a.hasTmpl,c=arguments,d=function(d){b&&(a.tmpl=a.wrapEvent(d)),J(a),a.fire("interact",0,1),r(a.init,c,a),a.fire("inited",0,1),a.owner.viewInited=1,a.render();var e=!b&&!a.rendered;e&&(a.rendered=1,a.fire("primed",0,1))};b?a.fetchTmpl(a.path,a.wrapAsync(d)):d()},beginUpdate:function(a){var b=this;b.sign>0&&b.rendered&&b.fire("prerender",{id:a||b.id})},endUpdate:function(a){var b=this;b.sign>0&&(b.rendered||(b.fire("primed",0,1),b.rendered=1),b.fire("rendered",{id:a||b.id}))},wrapAsync:function(a){var b=this,c=b.sign;return function(){c>0&&c==b.sign&&a&&a.apply(this,arguments)}},setHTML:function(a,b){var c,d=this;d.beginUpdate(a),d.sign>0&&(c=d.$(a),c&&(c.innerHTML=b)),d.endUpdate(a)},observeLocation:function(a){var b,c=this;b=c.$ol,b.f=1;var d=b.ks;k._o(a)&&(b.pn=a.path,a=a.params),a&&(b.ks=d.concat((a+f).split(g)))},olChg:function(a){var b,c=this,d=c.$ol;return d.f&&(d.pn&&(b=a.path),b||(b=a.isParam(d.ks))),b},oust:function(){var a=this;a.sign>0&&(a.sign=0,a.fire(w,0,1,1),H(a,1),J(a,1)),a.sign--},inside:function(a,b){var c,d,e=this;for(b=(b+f).split(g),d=b.length-1;d>=0&&!(c=e.$i(a,b[d]));d--);return c},manage:function(a,b,c){var d=this,e=1,g=d.$res;a&&!k._s(a)&&(c=b,b=a,a=f),a?I(g,a):(e=0,a="res_"+v++);var h={k:e,e:b,x:c};return g[a]=h,b},getManaged:function(b,c){var d=this,e=d.$res,f=b?a:e;return b&&s(e,b)&&(f=e[b].e,c&&delete e[b]),f},removeManaged:function(a){return this.getManaged(a,1)},destroyManaged:function(a){I(this.$res,a,1)}});var P={},Q="?t="+Math.random(),R={},S={};return N.fetchTmpl=function(a,b){var c=this,d="tmpl"in c;if(d)b(c.tmpl);else if(s(R,a))b(R[a]);else{var e=a.indexOf("/"),f=a.substring(0,e);P[f]||(P[f]=seajs.data.paths[f]);var g=P[f]+a.substring(e+1)+".html",h=S[g],i=function(c){b(R[a]=c)};h?h.push(i):(h=S[g]=[i],n.ajax({url:g+Q,success:function(a){r(h,a),delete S[g]},error:function(a,b){r(h,b),delete S[g]}}))}},M.extend=function(b,c,d){var e=this;k._f(c)&&(d=c,c=a);var f=function(a){e.call(this,a),d&&d.call(this,a)};return f.extend=e.extend,k.extend(f,e,b,c)},M}),h("magix/model",function(a){var b=a("./magix"),c=b.has,g=b._o,h=b.toString,i="URL",k="FORM",l=function(){this.id="m"+j++},m=function(a){return function(d,f,h){var i,j,k,l=this,m=e+a;l[m]||(l[m]={}),k=l[m],b._f(d)&&(d=b.tryCall(d)),d&&!g(d)&&(i={},i[d]=f,d=i);for(j in d)h&&c(k,j)||(k[j]=d[j])}};return b.mix(l.prototype,{sync:d,getFormParams:function(){return this[e+k]},getUrlParams:function(){return this[e+i]},setFormParams:m(k),setUrlParams:m(i),get:function(a,b,c){var d=this,e=arguments.length,g=2==e,i=d.$attrs;if(e){for(var j=(a+f).split(".");i&&j[0];)i=i[j.shift()];j[0]&&(i=c)}return g&&h.call(b)!=h.call(i)&&(i=b),i},set:function(a,b){var c=this;if(c.$attrs||(c.$attrs={}),a){if(!g(a)){var d={};d[a]=b,a=d}for(var e in a)c.$attrs[e]=a[e]}},request:function(a,b){var c=this;c.sync(function(d,e){g(e)||(e={data:e}),c.set(e),a(d,b)})}}),l.extend=function(a,c,d){var e=this,f=function(){e.call(this),d&&d.call(this)};return b.extend(f,e,a,c)},l}),h("magix/manager",function(c){var d=c("./magix"),h=c("./event"),i=d.has,k=d.tryCall,l=d._a,m=d._f,n=1,o=2,p=4,q="formParams",r="urlParams",s=[q,r],t=Date.now||function(){return+new Date},u=b.JSON,v=d.mix,w=12e5,x=function(a,b,c,d){return b?m(a)&&c.push(x(k(a))):d=u?u.stringify(a):t(),d},y=function(a,b){for(var c,d=[x(b),x(a)],f=s.length-1;f>-1;f--)c=s[f],x(a[c],1,d),x(b[c],1,d);return x(a.key,1,d),d.join(e)},z=function(a){var b=a.cache;return b&&(b=b===!0?w:0|b),b},A=function(a){throw Error(a)},B=function(a,b,c){var e=this;e.$mClz=a,e.$mCache=d.cache(b,c),e.$mReqs={},e.$mMetas={},e.id="mm"+j++},C=function(a){var b=this;b.$host=a,b.$reqs={},b.sign=1,b.id="mr"+j++,b.$queue=[]},D=[].slice,E=function(a,b,c,d){var e=function(f){return a.apply(b,[c,d,f,e.ost])};return e},F=function(a,b){var c=b.b,d=b.a,e=d[c];if(e){var f=e.q;delete d[c],k(f,a,e.e)}},G=function(b,c,d,e){var f,g,h=this,i=c.a,j=c.c,l=c.d,m=c.g,q=c.i,r=c.j,s=c.k,u=c.l,v=c.m,w=c.n,x=c.o;c.b++,delete j[h.id];var y=h.$mm,z=y.key;if(l[b+1]=h,d)c.e=1,f=1,c.f=d,m.msg=d,m[b]=d,r.fire("fail",{model:h,msg:d}),g=1;else if(!q.has(z)){z&&q.set(z,h),y.time=t();var A=y.after;A&&k(A,h),y.cls&&r.clearCache(y.cls),r.fire("done",{model:h}),g=1}if(!i.$ost&&!e){if(s==n){var B=u?v[b]:v;B&&(w[b+1]=k(B,[f?m:a,h,m],i))}else if(s==o){x[b]={m:h,e:f,s:d};for(var C,D,E=x.i||0;C=x[E];E++)D=u?v[E]:v,C.e&&(m.msg=C.s,m[E]=C.s),w[E+1]=k(D,[C.e?m:a,C.m,m].concat(w),i);x.i=E}c.b==c.h&&(c.e||(m=a),w[0]=m,s==p&&(l[0]=m,w[1]=k(v,l,i)),i.$busy=0,i.doNext(w))}g&&r.fire("finish",{msg:d,model:h})},H=function(a,b,c,d,e){if(a.$ost)return a;if(a.$busy)return a.next(function(){H(this,b,c,d,e)});a.$busy=1,a.sign++;var f=a.$host,g=f.$mCache,h=f.$mReqs,j=a.$reqs;l(b)||(b=[b]);var k=b.length,m=[],n=l(c);n&&(m=new Array(c.length));for(var o,p={a:a,b:0,c:a.$reqs,d:new Array(k),g:{},h:k,i:g,j:f,k:d,l:n,m:c,n:m,o:[]},q=0;q<b.length;q++)if(o=b[q]){var r=f.getModel(o,e),s=r.entity,t=s.$mm.key,u=E(G,s,q,p);u.id=a.id,t&&i(h,t)?h[t].q.push(u):r.update?(j[s.id]=s,t&&(h[t]={q:[u],e:s},u=F),s.request(u,{a:h,b:t})):u()}else A("empty model");return a},I=function(a,b){return function(c,d){var e=D.call(arguments,1);return H(this,c,e.length>1?e:d,a,b)}};v(B,{create:function(a,b,c){return new B(a,b,c)}}),v(C.prototype,{fetchAll:function(a,b){return H(this,a,b,p)},save:function(a,b){return H(this,a,b,p,1)},fetchOrder:I(o),fetchOne:I(n),next:function(a){var b=this;return b.$ost||(b.$queue.push(a),b.doNext(b.$args)),b},doNext:function(a){var b=this;if(!b.$busy&&!b.$ost){b.$busy=1;var c=++b.sign;b.$ntId=setTimeout(function(){b.$busy=0,b.$args=a;var d,e=b.$queue,f=e.shift();f&&(d=k(f,a,b),c==b.sign&&b.doNext(d===e.$?a:[null,d]))},0)}},destroy:function(){var a=this;a.$ost=1,clearTimeout(a.$ntId);var b=a.$host,c=a.$reqs,d=b.$mReqs;for(var e in c){var f,g,h=c[e],j=h.$mm.key;if(j&&i(d,j)){f=d[j],g=f.q;for(var k,l=0;l<g.length;l++)k=g[l],k.id==a.id&&(k.ost=1)}}a.$reqs={},a.$queue=[],a.$busy=0}});var J=B.prototype;return v(v(J,h),{registerModels:function(a){var b=this,c=b.$mMetas;l(a)||(a=[a]);for(var d,e,f,g=0;g<a.length;g++)d=a[g],d&&(e=d.name,e?c[e]&&A("already exist:"+e):A("miss name"),f=z(d),f&&(d.cache=f),c[e]=d)},registerMethods:function(a){v(this,a)},create:function(a){var b=this,c=b.getMeta(a),d=z(a)||c.cache,e=new b.$mClz;e.set(c),e.$mm={name:c.name,after:c.after,cls:c.cleans,key:d&&y(c,a)},a.name&&e.set(a),e.setUrlParams(c[r]),e.setFormParams(c[q]),e.setUrlParams(a[r]),e.setFormParams(a[q]);var f=c.before;return f&&k(f,e),b.fire("start",{model:e}),e},getMeta:function(a){var b=this,c=b.$mMetas,d=a.name||a,e=c[d];return e||A("Unfound:"+d),e},getModel:function(a,b){var c,d,e=this;return b||(c=e.getCached(a)),c||(d=1,c=e.create(a)),{entity:c,update:d}},createRequest:function(a,b,c){return a.manage(b,new C(this),arguments.length<3||c)},clearCache:function(a){var b=this,c=b.$mCache,e=c.list();a=d.toMap((a+f).split(g));for(var h=0;h<e.length;h++){var j=e[h],k=j.v,l=k&&k.$mm;l&&i(a,l.name)&&c.del(l.key)}},getCached:function(a){var b,c,d=this,e=d.$mCache,f=d.getMeta(a),g=z(a)||f.cache;if(g&&(c=y(f,a)),c){var h=d.$mReqs,i=h[c];i?b=i.e:(b=e.get(c),b&&g>0&&t()-b.$mm.time>g&&(e.del(c),b=0))}return b}}),B}),c.createElement("vframe")}(null,window,document,function(){},"","",",",define);