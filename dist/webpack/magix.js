/*3.1.7 Licensed MIT*/module.exports=function(){var n,t=require("$"),r=t.noop,e=function(n,t){var r=U.views;t(r[n])},i=function(){},o=function(n,t,r,e,o){return i[y]=t[y],o=new i,E(o,r),E(n,e),o.constructor=n,n[y]=o,n},c=t.isPlainObject,f=t.isArray,a=function(n,r){t(n).html(r)},u=0,s="",h=[],$=h.slice,d=",",v=null,l=window,p=document,m="#",g=JSON.stringify,w="\x1e",b="object",y="prototype",x="/",k=/[#?].*$/,V=/([^=&?\/#]+)=?([^&#?]*)/g,q=/(?!^)=|&/,I=function(n){return(n||"mx_")+u++},U={rootId:I(),error:function(n){throw n}},S=U.hasOwnProperty,T=function(n){return typeof n==b?n:p.getElementById(n)},j=function(n,t,r){if(n=T(n),t=T(t),n&&t&&(r=n==t,!r))try{r=t.contains?t.contains(n):16&t.compareDocumentPosition(n)}catch(e){}return r},E=function(n,t,r){for(r in t)n[r]=t[r];return n},O=function(n,t,r,e,i,o){for(f(n)||(n=[n]),f(t)||(t=[t]),e=0;o=n[e];e++)try{i=o&&o.apply(r,t)}catch(c){U.error(c)}return i},P=function(n,t){return n&&S.call(n,t)},Z=function(n,t){return t.f-n.f||t.t-n.t},A=function(n,t,r,e){e=this,e.c=[],e.b=0|t||5,e.x=e.b+(n||20),e.r=r};E(A[y],{get:function(n){var t=this,r=t.c,e=r[w+n];return e&&(e.f++,e.t=u++,e=e.v),e},each:function(n,t,r,e,i){for(r=this,e=r.c,i=e.length-1;i>-1;i--)n(e[i].v,t,r)},set:function(n,t){var r=this,e=r.c,i=w+n,o=e[i],c=r.b;if(!o){if(e.length>=r.x)for(e.sort(Z);c--;)o=e.pop(),o.f>0&&r.del(o.o);o={o:n},e.push(o),e[i]=o}o.v=t,o.f=1,o.t=u++},del:function(n){n=w+n;var t=this.c,r=t[n],e=this.r;r&&(r.f=-1,r.v=s,delete t[n],e&&O(e,r.o,r))},has:function(n){return P(this.c,w+n)}});var H,C=new A,M=function(n,t,r){try{r=decodeURIComponent(r)}catch(e){}H[t]=r},R=function(n){var t,r=C.get(n);return r||(H={},t=n.replace(k,s),n==t&&q.test(t)&&(t=s),n.replace(t,s).replace(V,M),C.set(n,r={a:t,b:H})),{path:r.a,params:E({},r.b)}},B=function(n,t,r){var e,i,o,c=[];for(i in t)e=t[i]+s,(!r||e||P(r,i))&&(e=encodeURIComponent(e),c.push(o=i+"="+e));return o&&(n+=(n&&(~n.indexOf("?")?"&":"?"))+c.join("&")),n},D=function(n,t){var r,e,i,o={};if(n&&(i=n.length))for(r=0;r<i;r++)e=n[r],o[t&&e?e[t]:e]=t?e:(0|o[e])+1;return o},F=Object.keys||function(n,t,r){t=[];for(r in n)P(n,r)&&t.push(r);return t},L={config:function(n,t){return t=U,n&&(t=c(n)?E(t,n):t[n]),t},boot:function(n){E(U,n),e(U.exts,function(){pn.on("changed",Un),en()})},toMap:D,toTry:O,toUrl:B,parseUrl:R,mix:E,has:P,keys:F,inside:j,node:T,guid:I,Cache:A},N="on",J={fire:function(n,t,r,e){var i,o,c,f,a=w+n,u=this,h=u[a];if(t||(t={}),t.type||(t.type=n),h)for(i=h.length,o=i-1;i--;)c=e?i:o-i,f=h[c],f.f?(f.x=1,O(f.f,t,u),f.x=s):f.x||(h.splice(c,1),o--);h=u[N+n],h&&O(h,t,u),r&&u.off(n)},on:function(n,t){var r=this,e=w+n,i=r[e]||(r[e]=[]);i.push({f:t})},off:function(n,t){var r,e,i=w+n,o=this,c=o[i];if(t){if(c)for(r=c.length;r--;)if(e=c[r],e.f==t){e.f=s;break}}else delete o[i],delete o[N+n]}};L.Event=J;var Q,_,z,G,K,W,X,Y,nn=t.isFunction,tn=m+"!",rn=function(n,t,r,e,i){n=B(n,t,i),n!=r.srcHash&&(n=tn+n,e?sn.replace(n):sn.hash=n)},en=function(){t(l).on("hashchange",pn.diff),pn.diff()},on="path",cn="view",fn="params",an=new A,un=new A,sn=l.location,hn={params:{},href:s},$n=/(?:^.*\/\/[^\/]+|#.*$)/gi,dn=/^[^#]*#?!?/,vn=function(n,t){if(G||(G=U.routes||{},K=U.unmatchView,X=U.defaultView,Y=U.defaultPath||x,W=nn(G),W||G[Y]||(G[Y]=X)),!n[cn]){var r=n.hash[on]||Q&&n.query[on]||Y;t=W?G.call(U,r,n):G[r]||K||X,n[on]=r,n[cn]=t}},ln=function(n,t){var r=n.href,e=t.href,i=r+w+e,o=un.get(i);if(!o){var c,f,a,u;o={force:!r},o[fn]=u={};var s,h,$=n[fn],d=t[fn],v=[on,cn].concat(F($),F(d));for(s=v.length-1;s>=0;s--)h=v[s],1==s&&($=n,d=t,u=o),f=$[h],a=d[h],f!=a&&(u[h]={from:f,to:a},c=1);un.set(i,o={a:c,b:o})}return o},pn=E({parse:function(n){n=n||sn.href;var t,r,e,i,o,c=an.get(n);return c||(t=n.replace($n,s),r=n.replace(dn,s),e=R(t),i=R(r),o=E({},e[fn]),E(o,i[fn]),c={href:n,srcQuery:t,srcHash:r,query:e,hash:i,params:o},vn(c),an.set(n,c)),c},diff:function(){var n=pn.parse(),t=ln(hn,hn=n);return t.a&&(z=hn[fn],pn.fire("changed",_=t.b)),_},to:function(n,t,r){!t&&c(n)&&(t=n,n=s);var e=R(n),i=e[fn],o=e[on],f=hn[on],a=hn.query[fn];if(E(i,t),o){if(!Q)for(f in a)P(i,f)||(i[f]=s)}else z&&(o=f,i=E(E({},z),i));rn(o,z=i,hn,r,a)}},J);L.Router=pn;var mn,gn,wn=function(n,t,r){n.$d||n.$h||n.$cc!=n.$rc||(n.$cr||(n.$cr=1,n.$ca=0,n.fire("created")),t=n.id,r=xn[n.pId],r&&!P(r.$r,t)&&(r.$r[t]=1,r.$rc++,wn(r)))},bn=function(n,t,r,e){t||(t={}),!n.$ca&&n.$cr&&(n.$cr=0,n.$ca=1,n.fire("alter",t),r=n.id,e=xn[n.pId],e&&P(e.$r,r)&&(e.$rc--,delete e.$r[r],bn(e,t)))},yn=function(t,r){return mn||(n=p.body,t=U.rootId,r=T(t),r||(n.id=t),mn=new Sn(t)),mn},xn={},kn=function(n,t){P(xn,n)||(xn[n]=t,Sn.fire("add",{vframe:t}),n=T(n),n&&(n.vframe=t))},Vn=function(n,t,r){for(t=n.$il;t.length;)r=t.shift(),r.r||n.invoke(r.n,r.a),delete t[r.k]},qn=function(n,t,r){r=xn[n],r&&(delete xn[n],Sn.fire("remove",{vframe:r,fcc:t}),n=T(n),n&&(n.vframe=v))},In=function(n,t){if(n&&(t=n.$v)&&t.$s>0){var r=Qn(t);r&&t.render();for(var e=n.children(),i=e.length,o=0;o<i;)In(xn[e[o++]])}},Un=function(n){var t,r=yn();(t=n.view)?r.mountView(t.to):In(r)},Sn=function(n,t,r){r=this,r.id=n,r.$c={},r.$cc=0,r.$rc=0,r.$s=1,r.$r={},r.$il=[],r.pId=t,kn(n,r)};E(Sn,E({all:function(){return xn},get:function(n){return xn[n]}},J)),E(E(Sn[y],J),{mountView:function(n,t){var r,i,o,c=this,f=T(c.id);if(!c.$a&&f&&(c.$a=1,c.$t=f.innerHTML),c.unmountView(),c.$d=0,f&&n){c.path=n,r=R(n),o=r.path,i=++c.$s;var a=r.params;E(a,t),e(o,function(n){i==c.$s&&(n||U.error(Error("cannot load:"+o)),Nn(n),o=new n({owner:c,id:c.id},a),c.$v=o,Dn(o),o.init(a),o.render(),o.tmpl||o.$p||o.endUpdate())})}},unmountView:function(){var n,t,r=this,e=r.$v;r.$il=[],e&&(gn||(t=1,gn={id:r.id}),r.$d=1,r.unmountZone(),bn(r,gn),r.$v=0,_n(e),n=T(r.id),n&&r.$a&&a(n,r.$t),t&&(gn=0)),r.$s++},mountVframe:function(n,t,r){var e,i=this;return bn(i),e=xn[n],e||(P(i.$c,n)||(i.$cl=s,i.$cc++),i.$c[n]=n,e=new Sn(n,i.id)),e.mountView(t,r),e},mountZone:function(n,r){var e,i,o,c=this;n=n||c.id;var f=t(m+n+" [mx-view]");for(c.$h=1,e=f.length-1;e>=0;e--)i=f[e],o=i.id||(i.id=I()),c.mountVframe(o,i.getAttribute("mx-view"),r);c.$h=0,wn(c)},unmountVframe:function(n,t){var r,e,i,o=this;n=n?o.$c[n]:o.id,r=xn[n],r&&(e=r.$cr,i=r.pId,r.unmountView(),qn(n,e),r.id=r.pId=s,r=xn[i],r&&P(r.$c,n)&&(delete r.$c[n],r.$cl=s,r.$cc--,t||wn(r)))},unmountZone:function(n){var t,r=this,e=r.$c;for(t in e)(!n||t!=n&&j(t,n))&&r.unmountVframe(t,1)},parent:function(n,t){for(t=this,n=n>>>0||1;t&&n--;)t=xn[t.pId];return t},children:function(n){return n=this,n.$cl||(n.$cl=F(n.$c))},invoke:function(n,t){var r,e,i,o,c,f,a=this;return(e=a.$v)&&e.$p?r=(i=e[n])&&O(i,t,e):(c=a.$il,o=c[f=w+n],o&&(o.r=1),o={n:n,a:t,k:f},c.push(o),c[f]=o),r}}),L.Vframe=Sn;var Tn=function(n,t){t=n.data,O(t.f,n,t.v)},jn=function(n,r,e,i,o,c){i?t(n).off(r,o,e):t(n).on(r,o,c,e)},En="parentNode",On=new A(30,10),Pn=/([^\(]+)\(([\s\S]*)?\)/,Zn={},An=function(t){for(var r,e,i,o,c,f,a,u,s,$,d=t.target,v=t.type,l="mx-"+v,p=[];d!=n&&1==d.nodeType;){if(r=d.getAttribute(l)){if(p=[],c=d.$f,!c)for(f=d;f=f[En];)if(P(xn,a=f.id)){d.$f=c=a;break}c?(i=xn[c],o=i&&i.$v,o&&o.$s>0&&(u=On.get(r),u||(u=r.match(Pn)||h,u={n:u[1],i:u[2]},u.p=u.i&&O(Function("return "+u.i))||{},On.set(r,u)),s=u.n+w+v,$=o[s],$&&(t.currentTarget=d,t.params=u.p,O($,t,o)))):U.error(Error("bad:"+r))}if((e=d.$)&&e[v]||t.mxStop||t.isPropagationStopped())break;p.push(d),d=d[En]||n,d.id==c&&(t.target=d)}for(;d=p.pop();)e=d.$||(d.$={}),e[v]=1},Hn=function(t,r){var e=0|Zn[t],i=e>0?1:0;e+=r?-i:i,e||(jn(n,t,An,r),r||(e=1)),Zn[t]=e},Cn=/^(\$?)([^<]+)<([^>]+)>$/,Mn=function(n,t){var r,e,i=n.$r;for(r in i)e=i[r],(t||e.x)&&Rn(i,r,1)},Rn=function(n,t,r){var e,i,o=n[t];return o&&(i=o.e,e=i.destroy,e&&r&&O(e,h,i),delete n[t]),i},Bn=function(n,t,r){t=n.render,n.render=function(){r=this,r.$s>0&&(r.$s++,r.fire("rendercall"),Mn(r),O(t,$.call(arguments),r))}},Dn=function(n,t){var r,e,i=n.$eo;for(r in i)Hn(r,t);for(i=n.$el,r=i.length;r--;)e=i[r],jn(e.e||m+n.id,e.n,Tn,t,e.s,{v:n,f:e.f})},Fn=[],Ln={win:l,doc:p},Nn=function(n){if(!n[w]){n[w]=1;var t,r,e,i,o,c,f,a,u=n[y],s={},h=[];for(f in u)if(t=u[f],r=f.match(Cn))for(c=r[1],e=r[2],i=r[3].split(d);a=i.pop();)c?(o=Ln[e],h.push({f:t,s:o?v:e,n:a,e:o})):(s[a]=1,u[e+w+a]=t);Bn(u),u.$eo=s,u.$el=h}},Jn=function(n,t,r){for(var e=0;e<n.length&&!(r=P(t,n[e]));e++);return r},Qn=function(n){var t,r=n.$l;return r.f&&(r.p&&(t=_[on]),t||(t=Jn(r.k,_[fn]))),t},_n=function(n){n.$s>0&&(n.$s=0,n.fire("destroy",0,1,1),Mn(n,1),Dn(n,1)),n.$s--},zn=function(n,t){t=this,E(t,n),t.$l={k:[]},t.$r={},t.$s=1,O(Fn,n,t)},Gn=zn[y];E(zn,{merge:function(n,t){t=n&&n.ctor,t&&Fn.push(t),E(Gn,n)},extend:function(n,t){var r=this;n=n||{};var e=n.ctor,i=function(n,t){r.call(this,n,t),e&&e.call(this,t)};return i.extend=r.extend,o(i,r,n,t)}}),E(E(Gn,J),{render:r,init:r,beginUpdate:function(n,t){t=this,t.$s>0&&t.$p&&t.owner.unmountZone(n)},endUpdate:function(n,t,r,e){t=this,t.$s>0&&(e=t.$p,t.$p=1,r=t.owner,r.mountZone(n),e||Vn(r))},wrapAsync:function(n,t){var r=this,e=r.$s;return function(){e>0&&e==r.$s&&n&&n.apply(t||r,arguments)}},observe:function(n,t){var r,e,i=this;r=i.$l,r.f=1,e=r.k,c(n)&&(t=n.path,n=n.params),r.p=t,n&&(r.k=e.concat((n+s).split(d)))},capture:function(n,t,r,e,i){return e=this.$r,t?(Rn(e,n,1),i={e:t,x:r},e[n]=i):(i=e[n],t=i&&i.e||t),t},release:function(n,t){return Rn(this.$r,n,t)},share:function(n,t){var r=this;r.$sd||(r.$sd={}),r.$sd[n]=t},getShared:function(n){var t,r=this,e=r.$sd;if(e&&(t=P(e,n)))return e[n];var i=r.owner.parent();return i?i.invoke("getShared",n):void 0},setHTML:function(n,t){var r,e=this;e.beginUpdate(n),e.$s>0&&(r=T(n),r&&a(r,t)),e.endUpdate(n)}}),L.View=zn;var Kn=t.type,Wn=t.proxy,Xn=t.now||Date.now,Yn=function(){this.id=I("b"),this.$={}};E(Yn[y],{get:function(n,t,r){var e=this,i=arguments.length,o=i>=2,c=e.$,a=c;if(i){for(var u,h=f(n)?$.call(n):(n+s).split(".");(u=h.shift())&&a;)a=a[u];u&&(a=r)}return o&&Kn(t)!=Kn(a)&&(U.error(Error("type neq:"+n+"\n"+g(c))),a=t),a},set:function(n,t){var r,e=this;c(n)||(r={},r[n]=t,n=r),E(e.$,n)}});var nt=1,tt=2,rt=function(n,t,r){r=this[n],r&&(delete this[n],O(r,t,r.e))},et=function(n,t,r,e,i,o){var c=[],f=v,a=0;return function(u,s){var h,$=this;a++;var d=$.$m,l=d.k;c[u+1]=$;var p={bag:$,error:s};if(s)f=s,t.fire("fail",p),h=1;else if(!o.has(l)){l&&o.set(l,$),d.t=Xn();var m=d.a;m&&O(m,$,$),d.x&&t.clear(d.x),t.fire("done",p),h=1}if(!r.$o){var g=a==e;g&&(r.$b=0,i==tt&&(c[0]=f,O(n,c,r))),i==nt&&O(n,[s?s:v,$,g,u],r)}h&&t.fire("end",p)}},it=function(n,t,r,e,i){if(n.$o)return n;if(n.$b)return n.enqueue(function(){it(this,t,r,e,i)});n.$b=1;var o=n.constructor,c=o.$r;f(t)||(t=[t]);for(var a,u=t.length,s=et(r,o,n,u,e,o.$c),h=0;h<u;h++)if(a=t[h]){var $,d=o.get(a,i),v=d.e,l=v.$m.k,p=Wn(s,v,h);l&&c[l]?c[l].push(p):d.u?(l&&($=[p],$.e=v,c[l]=$,p=Wn(rt,c,l)),o.$s(v,p)):p()}return n},ot=function(){var n=this;n.id=I("s"),n.$q=[]};E(ot[y],{all:function(n,t){return it(this,n,t,tt)},save:function(n,t){return it(this,n,t,tt,1)},one:function(n,t){return it(this,n,t,nt)},enqueue:function(n){var t=this;return t.$o||(t.$q.push(n),t.dequeue(t.$a)),t},dequeue:function(){var n=this,t=$.call(arguments);n.$b||n.$o||(n.$b=1,setTimeout(function(){if(n.$b=0,!n.$o){var r=n.$q.shift();r&&O(r,n.$a=t,n)}},0))},destroy:function(n){n=this,n.$o=1,n.$q=0}});var ct=function(n,t,r){return r=[g(t),g(n)],r.join(w)},ft=function(n,t,r,e){e=n&&n.$m,e&&t[e.n]&&r.del(e.k)},at=E({add:function(n){var t=this,r=t.$m;f(n)||(n=[n]);for(var e,i,o=n.length-1;o>-1;o--)e=n[o],e&&(i=e.name,e.cache=0|e.cache,r[i]=e)},create:function(n){var t=this,r=t.meta(n),e=r.cache,i=new Yn;i.set(r),i.$m={n:r.name,a:r.after,x:r.cleans,k:e&&ct(r,n)},c(n)&&i.set(n);var o=r.before;return o&&O(o,i,i),t.fire("begin",{bag:i}),i},meta:function(n){var t=this,r=t.$m,e=n.name||n,i=r[e];return i||n},get:function(n,t){var r,e,i=this;return t||(r=i.cached(n)),r||(r=i.create(n),e=1),{e:r,u:e}},clear:function(n){this.$c.each(ft,D((n+s).split(d)))},cached:function(n){var t,r,e=this,i=e.$c,o=e.meta(n),c=o.cache;if(c&&(r=ct(o,n)),r){var f=e.$r,a=f[r];a?t=a.e:(t=i.get(r),t&&c>0&&Xn()-t.$m.t>c&&(t=0))}return t}},J);ot.extend=function(n,t,r){var e=this,i=function(){e.call(this)};return i.$s=n,i.$c=new A(t,r),i.$r={},i.$m={},o(i,e,v,at)},L.Service=ot;var ut=function(n,t){var r=this,e=n&&n.ctor,i=function(){var n=this,t=arguments;r.apply(n,t),e&&e.apply(n,t)};return i.extend=ut,o(i,r,n,t)};return E(r[y],J),r.extend=ut,L.Base=r,L}();