/*!Magix 1.2 Licensed MIT*/!function(a,b,c,d,e,f,g,h,i,j){j=1,i=function(a){return a.id||(a.id="mx_n_"+j++)},h("magix/magix",["jquery"],function(c){var g=/\/\.(?:\/|$)|\/[^\/]+?\/\.{2}(?:\/|$)|\/\/+|\.{2}\//,h=/\/[^\/]*$/,i=/[#?].*$/,k=/([^=&?\/#]+)=?([^&#?]*)/g,l=/\?|(?!^)=/,m=/^https?:\/\//i,n="/",o="vframe",p=b.console,q=p&&p.error,r={tagName:o,rootId:"magix_vf_root",coded:1,error:q?function(a){p.error(a)}:d},s=r.hasOwnProperty,t=function(a,b){return a&&s.call(a,b)},u=function(b){return function(c,d,e){switch(arguments.length){case 0:e=b;break;case 1:e=C._o(c)?x(b,c):t(b,c)?b[c]:a;break;case 2:d===a?(delete b[c],e=d):b[c]=e=d}return e}},v=function(a,b){return b.f-a.f||b.t-a.t},w=function(a,b){var c=this;return c instanceof w?(c.c=[],c.b=0|b||5,c.x=c.b+(a||20)):c=new w(a,b),c},x=function(a,b,c,d){for(d in b)c&&t(c,d)||(a[d]=b[d]);return a};x(w.prototype,{get:function(a){var b,c=this,d=c.c;return a=e+a,t(d,a)&&(b=d[a],b.f>=1&&(b.f++,b.t=j++,b=b.v)),b},list:function(){return this.c},set:function(a,b,c){var d=this,f=d.c,g=e+a,h=f[g];if(!t(f,g)){if(f.length>=d.x){f.sort(v);for(var i=d.b;i--;)h=f.pop(),h.f>0&&d.del(h.o)}h={o:a},f.push(h),f[g]=h}return h.v=b,h.f=1,h.t=j++,h.m=c,b},del:function(a){a=e+a;var b=this.c,c=b[a];c&&(c.f=-1,c.v=f,delete b[a],c.m&&(A(c.m,c.o,c),c.m=f))},has:function(a){return t(this.c,e+a)}});var y=w(40),z=w(),A=function(a,b,c,d,e,f){for(C._a(a)||(a=[a]),b&&(C._a(b)||b.callee)||(b=[b]),d=0;d<a.length;d++)try{f=a[d],e=f&&f.apply(c,b)}catch(g){r.error(g)}return e},B=function(a,b,c){if(r.coded)try{c=decodeURIComponent(c)}catch(d){}B.p[b]=c},C={mix:x,has:t,tryCall:A,config:u(r),start:function(a){var b=this;x(r,a),b.use(["magix/router","magix/vom",a.iniFile],function(c,d,e){r=x(r,e,a),r["!tnc"]=r.tagName!=o,c.on("!ul",d.loc),c.on("changed",d.loc),b.use(r.extensions||r.exts,c.start)})},keys:Object.keys||function(a){var b,c=[];for(b in a)t(a,b)&&c.push(b);return c},local:u({}),path:function(a,b){var c,d=a+e+b,j=z.get(d),k=f;if(!z.has(d)){for(m.test(a)&&(c=a.indexOf(n,8),0>c&&(c=a.length),k=a.slice(0,c),a=a.slice(c)),a=a.replace(i,f).replace(h,n),(m.test(b)||b.charAt(0)==n)&&(a=f),j=a+b;g.test(j);)j=j.replace(g,n);z.set(d,j=k+j)}return j},toObject:function(a){var b,c,d=y.get(a);return d||(B.p=b={},c=a.replace(i,f),l.test(c)&&(c=f),a.replace(c,f).replace(k,B),y.set(a,d=[c,b])),{path:d[0],params:x({},d[1])}},toUrl:function(a,b,c){var d,e,f,g=[];for(e in b)d=b[e],(!c||d||t(c,e))&&(r.coded&&(d=encodeURIComponent(d)),f=1,g.push(e+"="+d));return f&&(a=(a&&a+(l.test(a)?"&":"?"))+g.join("&")),a},toMap:function(a,b){var c,d,e,f={},g=arguments.length>1;if(a&&(e=a.length))for(c=0;e>c;c++)d=a[c],f[g?d[b]:d]=g?d:(0|f[d])+1;return f},cache:w},D=function(){};return x(C,{use:function(a,b){a?(c.isArray(a)||(a=[a]),require(a,b)):b&&b()},_a:c.isArray,_f:c.isFunction,_s:function(a){return"string"==c.type(a)},_o:function(a){return"object"==c.type(a)},extend:function(a,b,c,d){var e=b.prototype;e.constructor=b,D.prototype=e;var f=new D;return x(f,c),x(a,d),f.constructor=a,a.prototype=f,a}})}),h("magix/event",["magix/magix"],function(a){var b=a.tryCall,c={fire:function(a,c,d,f){var g=e+a,h=this,i=h[g];if(i){c||(c={}),c.type||(c.type=a);for(var j,k,l=i.length,m=l-1;l--;)j=f?l:m-l,k=i[j],(k.d||k.r)&&(i.splice(j,1),m--),k.d||b(k.f,c,h);d=d||0>m}d&&delete h[g]},on:function(a,c,d,f){var g=this,h=e+a,i=g[h]||(g[h]=[]),j={f:c},k=0|d;k!==d?(d&&d.on&&f&&(d.on(f,function(){j.d=1},b),d=0),j.r=d,i.push(j)):i.splice(k,0,j)},off:function(a,b){var c=e+a,d=this[c];if(d)if(b){for(var f,g=d.length-1;g>=0;g--)if(f=d[g],f.f==b&&!f.d){f.d=1;break}}else delete this[c]},once:function(a,c){this.on(a,c,b)}};return a.mix(a.local,c),c}),h("magix/router",["magix/magix","magix/event","jquery"],function(a,c,d){var f,h,i,j,k,l,m="",n="path",o="view",p=a.has,q=a.mix,r=a.keys,s=a.toUrl,t=a.toObject,u=a.config(),v=a.cache(),w=a.cache(),x=b.location,y=b.history,z={params:{},href:m},A=/(?:^https?:\/\/[^\/]+|#.*$)/gi,B=/^[^#]*#?!?/,C="params",D=function(a,b,c){if(a){c=this[C],a=(a+m).split(g);for(var d=0;d<a.length&&!(b=p(c,a[d]));d++);}return b},E=function(){return this[n]},F=function(){return this[o]},G=function(a,b,c,d){return c=this,d=c[C],arguments.length>1?d[a]=b:d[a]||m},H=function(b,c){var d,e,f,g;return h||(h={rs:u.routes||{},nf:u.unfoundView},f=u.defaultView,h.dv=f,g=u.defaultPath,d=h.rs,h.f=a._f(d),h.f||d[g]||!f||(d[g]=f),h[n]=g),b||(b=h[n]),d=h.rs,e=h.f?d.call(u,b,c):d[b],{view:e||h.nf||h.dv,path:b}},I=function(a,b){var c=a.href,d=b.href,f=c+e+d,g=w.get(f);if(!g){var h,i,j,k;g={isParam:D,isPath:E,isView:F,location:b,force:!a.get},g[o]=j,g[n]=j,g[C]=k={};var l,m,p=a[C],q=b[C],s=[n,o].concat(r(p),r(q));for(l=s.length-1;l>=0;l--)m=s[l],1==l&&(p=a,q=b,k=g),i=p[m],j=q[m],i!=j&&(k[m]={from:i,to:j},h=1);w.set(f,g=[h,g])}return g},J=q({start:function(){i=u.edge,j=i&&y.pushState,k=i&&!j,l=j?"srcQuery":"srcHash",J.bind(j),J.route()},parse:function(b,c){b=b||x.href;var d,e,f,g,h,j,l=v.get(b);return l||(f=b.replace(A,m),g=b.replace(B,m),h=t(f),j=t(g),k&&(j[n]=a.path(x.pathname,j[n])),l={get:G,set:G,href:b,refHref:z.href,srcQuery:f,srcHash:g,query:h,hash:j,params:q(q({},h[C]),j[C])},v.set(b,l)),c&&!l[o]&&(e=l.hash[n]||i&&l.query[n],d=H(e,l),q(l,d)),l},route:function(){var a=J.parse(0,1),b=I(z,a);z=a,b[0]&&(f=a,J.fire("changed",b[1]))},navigate:function(b,c,d){if(f){!c&&a._o(b)&&(c=b,b=m);var e=t(b),g=f.query[C],h=e[C],o=e[n],r=f[n];if(q(h,c),o){if(o=a.path(r,o),k)for(var u in g)p(g,u)&&!p(h,u)&&(h[u]=m)}else o=r,h=q(q({},f[C]),h);o=s(e[n]=o,h,i?n:g),o!=f[l]&&(j?(y[d?"replaceState":"pushState"](m,m,o),J.route()):(q(e,f,e),e.srcHash=o,J.fire("!ul",{loc:f=e}),o="#!"+o,d?x.replace(o):x.hash=o),J.did=1)}}},c);return J.bind=function(a){var b=location.href;a?d(window).on("popstate",function(){var a=location.href==b;(J.did||!a)&&(J.did=1,J.route())}):d(window).on("hashchange",J.route)},J}),h("magix/vom",["magix/vframe","magix/magix","magix/event"],function(a,b,c){var d=b.has,e=b.mix,f={},g={},h={},i=b.mix({all:function(){return f},add:function(a,b){d(f,a)||(f[a]=b,i.fire("add",{vframe:b}))},get:function(a){return f[a]},remove:function(a,b){var c=f[a];c&&(delete f[a],i.fire("remove",{vframe:c,fcc:b}))},loc:function(b){var c,d=b.loc;if(d?c=1:d=b.location,e(g,d),!c){e(h,b);var f=a.root(i,g,h);h.view?f.mountView(d.view):a.update(f)}}},c);return i}),h("magix/vframe",["magix/magix","magix/event","magix/view"],function(b,d,e){var f,g,h,j,k,l,m,n,o,p,q,r=b.tryCall,s=[],t=b.mix,u=b.config(),v="mx-vframe",w=b.has,x="querySelectorAll",y="alter",z="created",A="object",B=function(a){return typeof a==A?a:c.getElementById(a)},C=function(a,b,d){return b=B(a),b&&(d=h?c[x]("#"+i(b)+k):b.getElementsByTagName(f)),d||s},D=function(a,b,c){if(a=B(a),b=B(b),a&&b)if(a!==b)try{c=l?b.contains(a):16&b.compareDocumentPosition(a)}catch(d){c=0}else c=1;return c},E=function(a){if(a.cC==a.rC){var b=a.view;b&&!a.fcc&&(a.fcc=1,a.fca=0,b.fire(z),a.fire(z));var c=a.id,d=q.get(a.pId);d&&!w(d.rM,c)&&(d.rM[c]=d.cM[c],d.rC++,E(d))}},F=function(a,b){if(b||(b={}),!a.fca&&a.fcc){a.fcc=0;var c=a.view,d=a.id;c&&(a.fca=1,c.fire(y,b),a.fire(y,b));var e=q.get(a.pId);e&&w(e.rM,d)&&(e.rC--,delete e.rM[d],a._p||F(e,b))}},G=function(a,b){var c=this;c.id=a,c.cM={},c.cC=0,c.rC=0,c.sign=1,c.rM={},c.pId=b,q.add(a,c)};return G.root=function(b,d,e){if(!m){f=u.tagName,g=u["!tnc"],h=g&&c[x],k=" "+f+"["+v+"=true]",j=g&&!h;var i=c.body;l=i.contains,o=d,p=e,q=b;var n=u.rootId,r=B(n);r||(r=c.createElement(f),r.id=n,i.appendChild(r),r=a),m=new G(n)}return m},G.update=function(a){var b=a.view;if(a.viewInited&&b&&b.sign>0){var c=b.olChg(p);c&&b.render(p);for(var d,e=a.children(),f=0,g=e.length;g>f;f++)d=q.get(e[f]),d&&G.update(d)}},t(t(G.prototype,d),{mountView:function(a,c,d){var f=this,g=B(f.id);if(!f._a&&g&&(f._a=1,f._t=g.innerHTML),f.unmountView(d),f._d=0,a){f.path=a;var h=b.toObject(a),i=h.path,j=++f.sign;b.use(i,function(a){if(j==f.sign){e.prepare(a,q);var b=new a({owner:f,id:f.id,$:B,$i:D,path:i,vom:q,location:o});f.view=b;var d=function(a){f.mountZoneVframes(a.id)};b.on("interact",function(){b.hasTmpl||(g&&(g.innerHTML=f._t),d(B)),b.on("rendered",d),b.on("prerender",function(a){f.unmountZoneVframes(a.id,0,1)||F(f)})},0),b.load(t(h.params,c),p)}})}},unmountView:function(a){var b=this,c=b.view;if(c){n||(n={}),b._d=1,b.unmountZoneVframes(0,a,1),F(b,n),b.view=0,c.oust();var d=B(b.id);d&&b._a&&!a&&(d.innerHTML=b._t),b.viewInited=0,n=0}b.sign++},mountVframe:function(a,b,c,d,e){var f=this;f.fcc&&!d&&F(f);var g=q.get(a);return g||(w(f.cM,a)||f.cC++,f.cM[a]=1,g=new G(a,f.id)),g._p=d,g.mountView(b,c,e),g},mountZoneVframes:function(a,b,c,d){var e=this;a=a||e.id,e.unmountZoneVframes(a,d,1);var f=C(a),g=f.length,h={};if(g)for(var k,l,m,n,o=0;g>o;o++)if(k=f[o],l=i(k),!w(h,l)&&(m=k.getAttribute("mx-view"),n=j?k.getAttribute(v):1,n||m)){e.mountVframe(l,m,b,c,d);for(var p,q=C(k),r=0,s=q.length;s>r;r++)p=q[r],h[i(p)]=1}E(e)},unmountVframe:function(a,b,c){var d=this;a=a||d.id;var e=q.get(a);if(e){var f=e.fcc;e.unmountView(b),q.remove(a,f);var g=q.get(e.pId);g&&w(g.cM,a)&&(delete g.cM[a],g.cC--,c||E(g))}},unmountZoneVframes:function(a,b,c){var d,e,f=this,g=f.cM;for(e in g)(!a||D(e,a))&&f.unmountVframe(e,b,d=1);return c||f._d||E(f),d},parent:function(a){var b=this,c=b;for(a=a>>>0||1;c&&a--;)c=q.get(c.pId);return c},children:function(){return b.keys(this.cM)},invokeView:function(a,b){var c,d=this;if(d.viewInited){var e=d.view,f=e&&e[a];f&&(c=r(f,b||s,e))}return c}}),G}),h("magix/view",["magix/magix","magix/event","magix/router","jquery"],function(h,j,k,l){var m,n={focus:2,blur:2,mouseenter:2,mouseleave:2},o=l.now(),p=function(a,b,c,d,e,g){var h=n[b];if(e){c.$n||(c.$n=o--);var i="_$"+c.$n;e[i]||(e[i]=function(){c.apply(e,arguments)}),c=e[i]}g||2!=h?l(a)[d?"off":D](b,c):l(a)[(d?"un":f)+"delegate"]("[mx-"+b+"]",b,c)},q=h.tryCall,r=h.has,s=[],t=h.mix,u=0,v="destroy",w=h.cache(40),x=/(\w+)(?:<(\w+)>)?(?:\(({[\s\S]*})\))?/,y=/([$\w]+)<([\w,]+)>/,z={},A=c.body,B="parentNode",C=/\smx-(?!view|vframe)[a-z]+\s*=\s*"/g,D="on",E="",F=function(a,b){return function(){b=this,b.sign>0&&(b.sign++,b.fire("rendercall"),G(b),q(a,arguments,b))}},G=function(a,b){var c,d,e=a.$res;for(c in e)d=e[c],(b||d.x)&&H(e,c,1)},H=function(a,b,c){var d,e,f=a[b];f&&(d=f.e,e=d&&d[v],e&&q(e,s,d),(!f.k||c)&&delete a[b])},I=function(a,b){var c,d,e=a.$evts;for(c in e)K(c,b);for(e=a.$sevts,c=e.length;c-->0;)d=e[c],p(d.h,d.t,d.f,b,a,1)},J=function(b){if(b&&!b[D]){var c=b.target;b[D]=1;for(var d,f,g,h=c,j=b.type,k="mx-"+j,l=[];h&&1==h.nodeType&&(f=h.ei,!(f&&f[j]||(d=h.getAttribute(k))));)l.push(h),h=h[B];if(d){for(var n,o,p,s,t,u,v,y,z,A=d.split(E);A.length;)if(o=A.shift()){if(p=o.split(e),o=p.pop(),u=p[0],!u&&!n)for(v=h,y=m.all();v;){if(r(y,z=v.id)){h.setAttribute(k,(u=z)+e+d);break}v=v[B]}if(n=1,!u)throw Error("bad:"+o);if(s=m.get(u),t=s&&s.view,t&&t.sign>0){b.currentId=i(h),b.targetId=i(c),b.prevent=b.preventDefault,b.stop=b.stopPropagation;var C=w.get(o);C||(C=o.match(x),C={n:C[1],f:C[2],i:C[3]},C.p=C.i&&q(Function("return "+C.i))||{},w.set(o,C));var F=C.n+e+j,G=t[F];G&&(b[C.f]&&b[C.f](),b.params=C.p,q(G,b,t))}}}else{for(;l.length;)g=l.pop(),f=g.ei||(g.ei={}),f[j]=1;g=a}h=c=a}},K=function(a,b){var c=0|z[a],d=c>0?1:0;c+=b?-d:d,c||(p(A,a,J,b),b||(c=1)),z[a]=c},L=function(a){var b=this;t(b,a),b.$ol={ks:[]},b.$res={},b.sign=1,q(L.$,a,b)},M=L.prototype,N={$win:b,$doc:c};L.$=[],L.prepare=function(a,b){if(!a[e]){a[e]=1,m=b;var c,d,f,h,i,j,k=a.prototype,l={},n=[];for(var o in k)if(c=k[o],d=o.match(y))for(f=d[1],h=d[2],h=h.split(g),i=h.length-1;i>-1;i--)d=h[i],j=N[f],j?n.push({n:f,t:d,h:j,f:c}):k[j=f+e+d]||(l[d]=1,k[j]=c);else"render"==o&&(k[o]=F(c));k.$evts=l,k.$sevts=n}},L.mixin=function(a,b){b&&L.$.push(b),t(M,a)},t(t(M,j),{render:d,navigate:k.navigate,init:d,hasTmpl:!0,wrapEvent:function(a,b){a+=f;var c=this.id+e;return a=b?[f].concat(a).join(E+c):a.replace(C,"$&"+c)},load:function(){var a=this,b=a.hasTmpl,c=arguments,d=function(d){b&&(a.tmpl=a.wrapEvent(d)),I(a),a.fire("interact",0,1),q(a.init,c,a),a.fire("inited",0,1),a.owner.viewInited=1,a.render();var e=!b&&!a.rendered;e&&(a.rendered=1,a.fire("primed",0,1))};b?a.fetchTmpl(a.path,a.wrapAsync(d)):d()},beginUpdate:function(a){var b=this;b.sign>0&&b.rendered&&b.fire("prerender",{id:a||b.id})},endUpdate:function(a){var b=this;b.sign>0&&(b.rendered||(b.fire("primed",0,1),b.rendered=1),b.fire("rendered",{id:a||b.id}))},wrapAsync:function(a){var b=this,c=b.sign;return function(){c>0&&c==b.sign&&a&&a.apply(this,arguments)}},setHTML:function(a,b){var c,d=this;d.beginUpdate(a),d.sign>0&&(c=d.$(a),c&&(c.innerHTML=b)),d.endUpdate(a)},observeLocation:function(a){var b,c=this;b=c.$ol,b.f=1;var d=b.ks;h._o(a)&&(b.pn=a.path,a=a.params),a&&(b.ks=d.concat((a+f).split(g)))},olChg:function(a){var b,c=this,d=c.$ol;return d.f&&(d.pn&&(b=a.path),b||(b=a.isParam(d.ks))),b},oust:function(){var a=this;a.sign>0&&(a.sign=0,a.fire(v,0,1,1),G(a,1),I(a,1)),a.sign--},inside:function(a,b){var c,d,e=this;for(b=(b+f).split(g),d=b.length-1;d>=0&&!(c=e.$i(a,b[d]));d--);return c},manage:function(a,b,c){var d=this,e=1,g=d.$res;a&&!h._s(a)&&(c=b,b=a,a=f),a?H(g,a):(e=0,a="res_"+u++);var i={k:e,e:b,x:c};return g[a]=i,b},getManaged:function(b,c){var d=this,e=d.$res,f=b?a:e;return b&&r(e,b)&&(f=e[b].e,c&&delete e[b]),f},removeManaged:function(a){return this.getManaged(a,1)},destroyManaged:function(a){H(this.$res,a,1)}});var O={},P="?t="+Math.random(),Q={},R={};return M.fetchTmpl=function(a,b){var c=this,d="tmpl"in c;if(d)b(c.tmpl);else if(r(Q,a))b(Q[a]);else{var e=a.indexOf("/"),f=a.substring(0,e);O[f]||(O[f]=require.s.contexts._.config.paths[f]);var g=O[f]+a.substring(e+1)+".html",h=R[g],i=function(c){b(Q[a]=c)};h?h.push(i):(h=R[g]=[i],l.ajax({url:g+P,success:function(a){q(h,a),delete R[g]},error:function(a,b){q(h,b),delete R[g]}}))}},L.extend=function(b,c,d){var e=this;h._f(c)&&(d=c,c=a);var f=function(a){e.call(this,a),d&&d.call(this,a)};return f.extend=e.extend,h.extend(f,e,b,c)},L}),h("magix/model",["magix/magix"],function(a){var b=a.has,c=a._o,g=a.toString,h="URL",i="FORM",k=function(){this.id="m"+j++},l=function(d){return function(f,g,h){var i,j,k,l=this,m=e+d;l[m]||(l[m]={}),k=l[m],a._f(f)&&(f=a.tryCall(f)),f&&!c(f)&&(i={},i[f]=g,f=i);for(j in f)h&&b(k,j)||(k[j]=f[j])}};return a.mix(k.prototype,{sync:d,getFormParams:function(){return this[e+i]},getUrlParams:function(){return this[e+h]},setFormParams:l(i),setUrlParams:l(h),get:function(a,b,c){var d=this,e=arguments.length,h=2==e,i=d.$attrs;if(e){for(var j=(a+f).split(".");i&&j[0];)i=i[j.shift()];j[0]&&(i=c)}return h&&g.call(b)!=g.call(i)&&(i=b),i},set:function(a,b){var d=this;if(d.$attrs||(d.$attrs={}),a){if(!c(a)){var e={};e[a]=b,a=e}for(var f in a)d.$attrs[f]=a[f]}},request:function(a,b){var d=this;d.sync(function(e,f){c(f)||(f={data:f}),d.set(f),a(e,b)})}}),k.extend=function(b,c,d){var e=this,f=function(){e.call(this),d&&d.call(this)};return a.extend(f,e,b,c)},k}),h("magix/manager",["magix/magix","magix/event"],function(c,d){var h=c.has,i=c.tryCall,k=c._a,l=c._f,m=1,n=2,o=4,p="formParams",q="urlParams",r=[p,q],s=Date.now||function(){return+new Date},t=b.JSON,u=c.mix,v=12e5,w=function(a,b,c,d){return b?l(a)&&c.push(w(i(a))):d=t?t.stringify(a):s(),d},x=function(a,b){for(var c,d=[w(b),w(a)],f=r.length-1;f>-1;f--)c=r[f],w(a[c],1,d),w(b[c],1,d);return w(a.key,1,d),d.join(e)},y=function(a){var b=a.cache;return b&&(b=b===!0?v:0|b),b},z=function(a){throw Error(a)},A=function(a,b,d){var e=this;e.$mClz=a,e.$mCache=c.cache(b,d),e.$mReqs={},e.$mMetas={},e.id="mm"+j++},B=function(a){var b=this;b.$host=a,b.$reqs={},b.sign=1,b.id="mr"+j++,b.$queue=[]},C=[].slice,D=function(a,b,c,d){var e=function(f){return a.apply(b,[c,d,f,e.ost])};return e},E=function(a,b){var c=b.b,d=b.a,e=d[c];if(e){var f=e.q;delete d[c],i(f,a,e.e)}},F=function(b,c,d,e){var f,g,h=this,j=c.a,k=c.c,l=c.d,p=c.g,q=c.i,r=c.j,t=c.k,u=c.l,v=c.m,w=c.n,x=c.o;c.b++,delete k[h.id];var y=h.$mm,z=y.key;if(l[b+1]=h,d)c.e=1,f=1,c.f=d,p.msg=d,p[b]=d,r.fire("fail",{model:h,msg:d}),g=1;else if(!q.has(z)){z&&q.set(z,h),y.time=s();var A=y.after;A&&i(A,h),y.cls&&r.clearCache(y.cls),r.fire("done",{model:h}),g=1}if(!j.$ost&&!e){if(t==m){var B=u?v[b]:v;B&&(w[b+1]=i(B,[f?p:a,h,p],j))}else if(t==n){x[b]={m:h,e:f,s:d};for(var C,D,E=x.i||0;C=x[E];E++)D=u?v[E]:v,C.e&&(p.msg=C.s,p[E]=C.s),w[E+1]=i(D,[C.e?p:a,C.m,p].concat(w),j);x.i=E}c.b==c.h&&(c.e||(p=a),w[0]=p,t==o&&(l[0]=p,w[1]=i(v,l,j)),j.$busy=0,j.doNext(w))}g&&r.fire("finish",{msg:d,model:h})},G=function(a,b,c,d,e){if(a.$ost)return a;if(a.$busy)return a.next(function(){G(this,b,c,d,e)});a.$busy=1,a.sign++;var f=a.$host,g=f.$mCache,i=f.$mReqs,j=a.$reqs;k(b)||(b=[b]);var l=b.length,m=[],n=k(c);n&&(m=new Array(c.length));for(var o,p={a:a,b:0,c:a.$reqs,d:new Array(l),g:{},h:l,i:g,j:f,k:d,l:n,m:c,n:m,o:[]},q=0;q<b.length;q++)if(o=b[q]){var r=f.getModel(o,e),s=r.entity,t=s.$mm.key,u=D(F,s,q,p);u.id=a.id,t&&h(i,t)?i[t].q.push(u):r.update?(j[s.id]=s,t&&(i[t]={q:[u],e:s},u=E),s.request(u,{a:i,b:t})):u()}else z("empty model");return a},H=function(a,b){return function(c,d){var e=C.call(arguments,1);return G(this,c,e.length>1?e:d,a,b)}};u(A,{create:function(a,b,c){return new A(a,b,c)}}),u(B.prototype,{fetchAll:function(a,b){return G(this,a,b,o)},save:function(a,b){return G(this,a,b,o,1)},fetchOrder:H(n),fetchOne:H(m),next:function(a){var b=this;return b.$ost||(b.$queue.push(a),b.doNext(b.$args)),b},doNext:function(a){var b=this;if(!b.$busy&&!b.$ost){b.$busy=1;var c=++b.sign;b.$ntId=setTimeout(function(){b.$busy=0,b.$args=a;var d,e=b.$queue,f=e.shift();f&&(d=i(f,a,b),c==b.sign&&b.doNext(d===e.$?a:[null,d]))},0)}},destroy:function(){var a=this;a.$ost=1,clearTimeout(a.$ntId);var b=a.$host,c=a.$reqs,d=b.$mReqs;for(var e in c){var f,g,i=c[e],j=i.$mm.key;if(j&&h(d,j)){f=d[j],g=f.q;for(var k,l=0;l<g.length;l++)k=g[l],k.id==a.id&&(k.ost=1)}}a.$reqs={},a.$queue=[],a.$busy=0}});var I=A.prototype;return u(u(I,d),{registerModels:function(a){var b=this,c=b.$mMetas;k(a)||(a=[a]);for(var d,e,f,g=0;g<a.length;g++)d=a[g],d&&(e=d.name,e?c[e]&&z("already exist:"+e):z("miss name"),f=y(d),f&&(d.cache=f),c[e]=d)},registerMethods:function(a){u(this,a)},create:function(a){var b=this,c=b.getMeta(a),d=y(a)||c.cache,e=new b.$mClz;e.set(c),e.$mm={name:c.name,after:c.after,cls:c.cleans,key:d&&x(c,a)},a.name&&e.set(a),e.setUrlParams(c[q]),e.setFormParams(c[p]),e.setUrlParams(a[q]),e.setFormParams(a[p]);var f=c.before;return f&&i(f,e),b.fire("start",{model:e}),e},getMeta:function(a){var b=this,c=b.$mMetas,d=a.name||a,e=c[d];return e||z("Unfound:"+d),e},getModel:function(a,b){var c,d,e=this;return b||(c=e.getCached(a)),c||(d=1,c=e.create(a)),{entity:c,update:d}},createRequest:function(a,b,c){return a.manage(b,new B(this),arguments.length<3||c)},clearCache:function(a){var b=this,d=b.$mCache,e=d.list();a=c.toMap((a+f).split(g));for(var i=0;i<e.length;i++){var j=e[i],k=j.v,l=k&&k.$mm;l&&h(a,l.name)&&d.del(l.key)}},getCached:function(a){var b,c,d=this,e=d.$mCache,f=d.getMeta(a),g=y(a)||f.cache;if(g&&(c=x(f,a)),c){var h=d.$mReqs,i=h[c];i?b=i.e:(b=e.get(c),b&&g>0&&s()-b.$mm.time>g&&(e.del(c),b=0))}return b}}),A}),c.createElement("vframe")}(null,window,document,function(){},"","",",",define);